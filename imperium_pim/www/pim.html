{% extends "templates/web.html" %}

{% block title %}{{ title }}{% endblock %}

{% block head_include %}
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="{{ description }}">
    
    <!-- Include React build CSS -->
    {% for css_file in react_assets.css %}
    <link rel="stylesheet" href="{{ css_file }}">
    {% endfor %}
    
    <!-- Global configuration for the frontend app -->
    <script>
        // Wait for Frappe to be available (loaded by web.html template)
        document.addEventListener('DOMContentLoaded', function() {
            // Ensure frappe is available globally
            window.frappe = window.frappe || {};
            
            // Global configuration for the frontend app
            window.FRAPPE_CONFIG = {
                csrf_token: (typeof frappe !== 'undefined' && frappe.csrf_token) ? frappe.csrf_token : '',
                user: (typeof frappe !== 'undefined' && frappe.session) ? frappe.session.user : 'Guest',
                api_base: '/api/method/imperium_pim.api'
            };
            
            // Log when Frappe is ready
            if (typeof frappe !== 'undefined') {
                console.log('Frappe framework available for React app');
            } else {
                console.warn('Frappe framework not yet available');
            }
        });
    </script>
{% endblock %}

{% block content %}
    <!-- React app will mount here -->
    <div id="__next">
        <div style="display: flex; align-items: center; justify-content: center; min-height: 100vh;">
            <div style="text-align: center;">
                <div style="width: 48px; height: 48px; border: 2px solid #e5e7eb; border-top: 2px solid #2563eb; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 16px;"></div>
                <p style="color: #6b7280;">Loading PIM Dashboard...</p>
            </div>
        </div>
    </div>
    
    <!-- Include the React build files dynamically -->
    {% for webpack_file in react_assets.js.webpack %}
    <script src="{{ webpack_file }}"></script>
    {% endfor %}
    
    {% for framework_file in react_assets.js.framework %}
    <script src="{{ framework_file }}"></script>
    {% endfor %}
    
    {% for main_file in react_assets.js.main %}
    <script src="{{ main_file }}"></script>
    {% endfor %}
    
    {% for main_app_file in react_assets.js.main_app %}
    <script src="{{ main_app_file }}"></script>
    {% endfor %}
    
    {% for app_page in react_assets.js.app_pages %}
    <script src="{{ app_page }}"></script>
    {% endfor %}
    
    <style>
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
{% endblock %}
